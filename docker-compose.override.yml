services:
  control-plane:
    build:
      context: ./apps/control-plane
      dockerfile: Dockerfile
    env_file:
      - ./.env
    environment:
      CONTROL_PLANE_REGISTRY_PATH: /app/data/mcp_registry.json
      CONTROL_PLANE_ADMIN_KEY: ${CONTROL_PLANE_ADMIN_KEY}
      GATEWAY_BASE_URL: http://gateway:4000
      GATEWAY_ADMIN_KEY: ${LITELLM_MASTER_KEY}
      MCP_SCAN_INTERVAL_SECONDS: ${MCP_SCAN_INTERVAL_SECONDS}
      MCP_AUTO_QUARANTINE: ${MCP_AUTO_QUARANTINE:-true}
    volumes:
      - control_plane_data:/app/data
    ports:
      - "4051:8010"
    depends_on:
      - gateway
    restart: unless-stopped
volumes:
  control_plane_data:
